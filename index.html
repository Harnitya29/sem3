<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CLI PDF/PPT Reader</title>
  <script src="https://unpkg.com/vue@3.4.15/dist/vue.global.prod.js"></script>

  <style>
    body {
      background-color: #000;
      color: #00ff00;
      font-family: monospace;
      padding: 20px;
    }
    input.cli {
      background-color: black;
      color: #00ff00;
      border: none;
      width: 100%;
      font-family: monospace;
      padding: 6px;
    }
    a {
      color: #00ff00;
      text-decoration: underline;
      cursor: pointer;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: 2px solid #00ff00;
      margin-top: 10px;
    }
    textarea {
      background: black;
      color: #00ff00;
      width: 100%;
      border: 1px solid #00ff00;
      padding: 10px;
      font-family: monospace;
      margin-top: 10px;
    }
    button {
      background-color: #00ff00;
      color: black;
      padding: 5px 10px;
      border: none;
      margin-top: 10px;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      iframe { height: 300px; }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- CLI Boot Interface -->
    <div v-if="!entered">
      <div v-for="line in bootLogs" :key="line">{{ line }}</div>
      > <input class="cli" v-model="command" @keyup.enter="processCommand" placeholder="Type command: enter /sem3" />
    </div>

    <!-- File Reader Interface -->
    <div v-else>
      <h2>üìÅ CLI Reader (Guest)</h2>
      <input class="cli" v-model="searchQuery" placeholder="Search files..." />

      <ul>
        <li v-for="(files, subject) in filteredFiles" :key="subject">
          <strong>{{ subject }}</strong>
          <ul>
            <li v-for="file in files" :key="file.name">
              <a @click="openViewer(file)">{{ file.name }}</a>
            </li>
          </ul>
        </li>
      </ul>

      <div v-if="viewerUrl">
        <iframe :src="viewerUrl" allowfullscreen></iframe>
      </div>
      <div v-else>
        <p><em>Select a file to preview...</em></p>
      </div>

      <h4>üìù Notes for: {{ currentDoc }}</h4>
      <textarea v-model="notes" placeholder="Write your notes here..."></textarea>
      <button @click="saveNotes">üíæ Save Notes</button>
      <button @click="cdBack">‚¨ÖÔ∏è cd ..</button>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive, computed } = Vue;

    createApp({
      setup() {
        const bootLogs = ref([
          "System booting...",
          "Modules loaded.",
          `Welcome to ${window.location.hostname}`,
          "Type: enter /sem3"
        ]);

        const entered = ref(false);
        const command = ref('');
        const searchQuery = ref('');
        const currentDoc = ref('');
        const viewerUrl = ref('');
        const notes = ref(localStorage.getItem('cliReaderNotes') || '');
        const files = reactive({});

        const filteredFiles = computed(() => {
          if (!searchQuery.value) return files;
          const result = {};
          for (const [subject, list] of Object.entries(files)) {
            const matched = list.filter(f => f.name.toLowerCase().includes(searchQuery.value.toLowerCase()));
            if (matched.length) result[subject] = matched;
          }
          return result;
        });

        function processCommand() {
          if (command.value.trim().toLowerCase() === 'enter /sem3') {
            entered.value = true;
            loadFiles();
          } else {
            bootLogs.value.push(`Unknown command: ${command.value}`);
          }
          command.value = '';
        }

        function cdBack() {
          entered.value = false;
          viewerUrl.value = '';
          currentDoc.value = '';
        }

        function saveNotes() {
          localStorage.setItem('cliReaderNotes', notes.value);
          alert('‚úÖ Notes saved locally');
        }

        async function loadFiles() {
          try {
            const res = await fetch('docs.json');
            const data = await res.json();

            for (const [subject, urls] of Object.entries(data)) {
              files[subject] = urls.map(url => ({
                name: url.split('/').pop(),
                url
              }));
            }
          } catch (err) {
            alert('‚ùå Failed to load docs.json');
            console.error(err);
          }
        }

        function openViewer(file) {
          currentDoc.value = file.name;
          const encodedURL = encodeURIComponent(file.url);
          viewerUrl.value = `https://docs.google.com/gview?url=${encodedURL}&embedded=true`;
        }

        return {
          bootLogs,
          entered,
          command,
          searchQuery,
          filteredFiles,
          currentDoc,
          notes,
          viewerUrl,
          processCommand,
          cdBack,
          saveNotes,
          openViewer
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
